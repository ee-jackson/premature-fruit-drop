---
title: "Seed predators and premature fruit drop"
author: "E.E. Jackson"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: pdf_document 
---
```{r, message=FALSE, warning=FALSE}
rm(list = ls())
require(tidyverse)
require(reshape2)
require(ggExtra)
theme_set(theme_bw())
```

# Read and merge datasets #

```{r, fig_width=6, fig_height=4}
tidyTraits <- read.csv("../data/TidyTrait.csv", header=TRUE, stringsAsFactors = FALSE)

sumDat <- read.csv("../output/tables/summarizeSeedRain.csv", header=TRUE, stringsAsFactors = FALSE)

traitDat <- dplyr::left_join(sumDat, tidyTraits, by = c("sp" = "Codigo"), all.x=TRUE)
```

# Create datasets where presence/absence data are melted #

```{r, fig_width=6, fig_height=4}
# for different predator orders
traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "Coleo_pres", "Hymeno_pres", "Lepid_pres", "proportion_abscised")) %>%
	melt(id.vars=c("sp", "proportion_abscised"), measure.vars=c("Coleo_pres", "Hymeno_pres", "Lepid_pres")) %>%
	rename(predator=variable, presence=value)-> presDat.o

# for presence/absence of any predator
traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "SeedPred_pres", "proportion_abscised")) %>%
	melt(id.vars=c("sp", "proportion_abscised"), measure.vars=c("SeedPred_pres")) %>%
	rename(predator=variable, presence=value)-> presDat.a

# same as above but with weighted proportion absicsed
traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "Coleo_pres", "Hymeno_pres", "Lepid_pres", "proportion_abscised_w")) %>%
	melt(id.vars=c("sp", "proportion_abscised_w"), measure.vars=c("Coleo_pres", "Hymeno_pres", "Lepid_pres")) %>%
	rename(predator=variable, presence=value)-> presDat.w.o

traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "SeedPred_pres", "proportion_abscised_w")) %>%
	melt(id.vars=c("sp", "proportion_abscised_w"), measure.vars=c("SeedPred_pres")) %>%
	rename(predator=variable, presence=value)-> presDat.w.a
```

# Plot #

```{r, fig_width=6, fig_height=4}
ggplot(na.omit(presDat.o), aes(y=proportion_abscised, group=presence, x=presence)) + 
		geom_boxplot(alpha= 0.8,position = position_dodge2(preserve = "single"), width=0.4)+
		facet_wrap(~predator) +
		geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5) +
		scale_x_continuous(breaks=c(0,1), labels=c(0,1), limits=c(-0.5,1.5))

ggplot(na.omit(presDat.w.o), aes(y=proportion_abscised_w, group=presence, x=presence)) + 
		geom_boxplot(alpha= 0.8,position = position_dodge2(preserve = "single"), width=0.4)+
		facet_wrap(~predator) +
		geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5) +
		scale_x_continuous(breaks=c(0,1), labels=c(0,1), limits=c(-0.5,1.5))

ggplot(na.omit(presDat.a), aes(y=proportion_abscised, group=presence, x=presence)) + 
		geom_boxplot(alpha= 0.8,position = position_dodge2(preserve = "single"), width=0.4)+
		geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5) +
		scale_x_continuous(breaks=c(0,1), labels=c(0,1), limits=c(-0.5,1.5))

ggplot(na.omit(presDat.w.a), aes(y=proportion_abscised_w, group=presence, x=presence)) + 
		geom_boxplot(alpha= 0.8,position = position_dodge2(preserve = "single"), width=0.4)+
		geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5) +
		scale_x_continuous(breaks=c(0,1), labels=c(0,1), limits=c(-0.5,1.5))
```

# Try looking at different lifeforms #

```{r, fig_width=6, fig_height=4}
traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "SeedPred_pres", "proportion_abscised_w", "LIFEFORM")) %>%
	melt(id.vars=c("sp", "proportion_abscised_w", "LIFEFORM"), measure.vars=c("SeedPred_pres")) %>%
	rename(predator=variable, presence=value)-> presDat.w.a.l

ggplot(na.omit(presDat.w.a.l), aes(y=proportion_abscised_w, group=presence, x=presence)) + 
		geom_boxplot(alpha= 0.8,position = position_dodge2(preserve = "single"), width=0.4)+
		facet_wrap(~LIFEFORM) +
		geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5) +
		scale_x_continuous(breaks=c(0,1), labels=c(0,1), limits=c(-0.5,1.5))
```

# Can I look at different predators and lifeforms at the same time? #

```{r, fig_width=6, fig_height=4}
traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "Coleo_pres", "Hymeno_pres", "Lepid_pres", "proportion_abscised_w","LIFEFORM")) %>%
	melt(id.vars=c("sp", "proportion_abscised_w","LIFEFORM"), measure.vars=c("Coleo_pres", "Hymeno_pres", "Lepid_pres")) %>%
	rename(predator=variable, presence=value)-> presDat.w.o.l

ggplot(na.omit(presDat.w.o.l), aes(y=proportion_abscised_w, group=presence, x=presence)) + 
		geom_boxplot(alpha= 0.8,position = position_dodge2(preserve = "single"), width=0.2)+
		facet_grid(LIFEFORM~predator) +
		geom_jitter(shape=16, position=position_jitter(0.1), alpha=0.4) +
		scale_x_continuous(breaks=c(0,1), labels=c(0,1), limits=c(-0.5,1.5))
```

	* Coleoptera and Lepidoptera predators correlate to higher proportion abscised in shrubs
	* Coleoptera and Hymenoptera predators correlate to higher proportion abscised in midstory trees

# Other traits that might be influencing a proportion abscised ~ predator presence interaction ? #

```{r, fig_width=6, fig_height=4}
# weight of seed

traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "SeedPred_pres", "proportion_abscised_w","seed_dry")) %>%
	melt(id.vars=c("sp", "proportion_abscised_w","seed_dry"), measure.vars=c("SeedPred_pres")) %>%
	rename(predator=variable, presence=value)-> presDat.w.seed

ggplot(na.omit(presDat.w.seed), aes(y=proportion_abscised_w, group=as.factor(presence), x=seed_dry, colour=as.factor(presence))) + 
	geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.8, size=3) +
	scale_x_continuous(limits=c(-0.25,1.5)) 

# n of seed predators

traitDat %>%
	subset(total_seeds>50) %>%
	select(c("sp", "SeedPred_n", "proportion_abscised_w")) %>%
	melt(id.vars=c("sp", "proportion_abscised_w"), measure.vars=c("SeedPred_n")) %>%
	rename(predator=variable, SeedPred_n=value)-> presDat.w.n

ggplot(na.omit(presDat.w.n), aes(y=proportion_abscised_w, x=SeedPred_n, group=SeedPred_n)) +
	geom_boxplot(alpha= 0.8,position = position_dodge2(preserve = "single"), width=0.4, outlier.shape=NA)+ 
	geom_jitter(shape=16, position=position_jitter(0.2), alpha=0.5, size=2) 

```
